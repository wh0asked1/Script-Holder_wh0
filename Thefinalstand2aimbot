-- Mobile-compatible Silent Aim with center circle
getgenv().FOV = 350
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local Client = Players.LocalPlayer
local RunService = game:GetService("RunService")
local camera = workspace.CurrentCamera

-- IDENTICAL NETWORK HOOK
setthreadidentity(2)
local bb = require(Client.PlayerScripts.LocalManager.NetworkManager)
setthreadidentity(8)

local Zombies = workspace.Zombies
local SSCoreFunctions = {}

do
    local _container = SSCoreFunctions
    local rayParams = RaycastParams.new()
    _container.current_target = nil
    
    local function GetClosestTarget()
        local bestTarget = nil
        local closestDistance = math.huge
        
        -- Get the CENTER of the screen
        local viewportSize = camera.ViewportSize
        local centerPos = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
        
        local function checkCharacter(char)
            local part = char:FindFirstChild("Head")
            if not part then return end
            
            -- Check distance to player first
            local charPosition = char:GetPivot().Position
            local playerPosition = Client.Character and Client.Character:GetPivot().Position
            if not playerPosition then return end
            
            local distanceToPlayer = (charPosition - playerPosition).Magnitude
            
            -- Now check if within FOV circle
            local viewportPoint = camera:WorldToViewportPoint(part.Position)
            if viewportPoint.Z < 0 then return end
            
            local screenPos = Vector2.new(viewportPoint.X, viewportPoint.Y)
            local screenDistance = (screenPos - centerPos).Magnitude
            
            if screenDistance > FOV then return end
            
            -- Target the CLOSEST to player within FOV
            if distanceToPlayer < closestDistance then
                bestTarget = part
                closestDistance = distanceToPlayer
            end
        end
        
        for _, v in ipairs(Zombies:GetChildren()) do
            if v and v:IsA("Model") then
                local humanoid = v:FindFirstChildOfClass("Humanoid")
                if humanoid and humanoid.Health > 0 then
                    checkCharacter(v)
                end
            end
        end
        return bestTarget
    end
    
    _container.GetClosestTarget = GetClosestTarget
    
    local function innit()
        RunService.RenderStepped:Connect(function()
            _container.current_target = GetClosestTarget()
        end)
    end
    
    _container.innit = innit
end

-- IDENTICAL NETWORK HOOK
local old; old = hookfunction(bb.PassData, function(...)
    local arguments = {...}
    if arguments[2] == "WeaponAttack" then
        table.foreach(arguments, warn)
        if rawget(arguments[3][3], "3247E18F") ~= nil then
            rawset(arguments[3][3], "3247E18F", nil)
        end
    end
    return old(unpack(arguments))
end)

-- IDENTICAL NAMECALL HOOK
local __namecall; __namecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local arguments = {...}
    if method == "FindPartOnRayWithIgnoreList" and typeof(arguments[1]) == "Ray" then
        local target = SSCoreFunctions.current_target
        if target then
            arguments[1] = Ray.new(camera.CFrame.Position, (target.Position - camera.CFrame.Position).Unit * 10000)
        end
    end
    return __namecall(self, unpack(arguments))
end)

SSCoreFunctions.innit()

-- FIXED: Accurate center circle that doesn't move
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SilentAimCircle"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 999
screenGui.IgnoreGuiInset = true
screenGui.Parent = game:GetService("CoreGui") or Client:WaitForChild("PlayerGui")

-- Main circle frame that's perfectly centered
local circle = Instance.new("Frame")
circle.Name = "FOVCircle"
circle.AnchorPoint = Vector2.new(0.5, 0.5) -- Perfect center
circle.Size = UDim2.new(0, FOV * 2, 0, FOV * 2)
circle.Position = UDim2.new(0.5, 0, 0.5, 0) -- Absolute center
circle.BackgroundTransparency = 1
circle.BorderSizePixel = 0
circle.Visible = true
circle.ZIndex = 999
circle.Parent = screenGui

-- Perfect circle shape
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(1, 0) -- Perfect circle
uiCorner.Parent = circle

-- Circle outline
local uiStroke = Instance.new("UIStroke")
uiStroke.Thickness = 1.5
uiStroke.Color = Color3.fromRGB(232, 173, 56)
uiStroke.Transparency = 0.3
uiStroke.LineJoinMode = Enum.LineJoinMode.Round
uiStroke.Parent = circle

-- ADDITIONAL: Center dot for reference
local centerDot = Instance.new("Frame")
centerDot.Name = "CenterDot"
centerDot.AnchorPoint = Vector2.new(0.5, 0.5)
centerDot.Size = UDim2.new(0, 4, 0, 4)
centerDot.Position = UDim2.new(0.5, 0, 0.5, 0) -- Same center as circle
centerDot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
centerDot.BackgroundTransparency = 0.5
centerDot.BorderSizePixel = 0
centerDot.ZIndex = 1000
centerDot.Parent = screenGui

local dotCorner = Instance.new("UICorner")
dotCorner.CornerRadius = UDim.new(1, 0)
dotCorner.Parent = centerDot

-- Update ONLY the appearance, NOT the position
RunService.RenderStepped:Connect(function()
    -- Circle stays PERFECTLY centered - position NEVER changes
    -- Only update color based on target
    if SSCoreFunctions.current_target then
        uiStroke.Color = Color3.fromRGB(255, 50, 50)
        uiStroke.Transparency = 0.1
    else
        uiStroke.Color = Color3.fromRGB(232, 173, 56)
        uiStroke.Transparency = 0.3
    end
    
    -- Update FOV size if changed
    circle.Size = UDim2.new(0, FOV * 2, 0, FOV * 2)
end)

-- Make sure the circle stays on top and doesn't move
game:GetService("RunService").Heartbeat:Connect(function()
    -- Force keep it centered
    circle.Position = UDim2.new(0.5, 0, 0.5, 0)
    centerDot.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    -- Update size if FOV changed
    circle.Size = UDim2.new(0, FOV * 2, 0, FOV * 2)
    
    -- Keep it visible
    circle.Visible = true
    screenGui.Enabled = true
end)

-- Clean up if needed
game:GetService("Players").PlayerRemoving:Connect(function(player)
    if player == Client then
        screenGui:Destroy()
    end
end)

print("Silent Aim Active")
print("✓ Circle locked in center")
print("✓ Targets closest zombie")
print("✓ FOV: " .. FOV)
